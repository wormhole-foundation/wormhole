#!/bin/bash

set -meuo pipefail

# Anvil Private Key
PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

# Contract Addresses
MOCK_ADDRESS=0x5FbDB2315678afecb367f032d93F642f64180aa3
VERIFIER_ADDRESS=0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512

# Guardian Set
APPEND_SET_FUNCTION_SIG="appendGuardianSet((address[], uint32))"
EXPIRATION_TIME=$(date -d "1 year" +%s)

GUARDIAN_ADDRESSES=(
  "0x1bB315E24af6Bb5DaBA538dD17A6168CFA91A213"
  "0xd1FfC4DD68bD8F241032b5BeaC1Cf6099c5c8011"
  "0x7Ab4F18499e49fF14B1B1EAaD92c0229036AD052"
  "0x4ac1bDFCDc3Ef49A9553d1BCf6a56e36E815eA06"
  "0xD1523F8e5dC2ecf403Dc733819CB20185F8D6Ad1"
  "0xb7d8612e65d6f95707173492bb497728108B6b9a"
  "0x3022Ee66b0fD56D6a3F0B5b520973b29c2Ef67ea"
  "0x8b0798246b538f49EaF429B5b011eb65c5A30CDe"
  "0x9b550E6cb0553dEE579ecf2700D096BB235783F1"
  "0x7BA7f6ACFcD9a721eB906A2Da8Ebcbc8a83F250B"
  "0x6ebDa46121D17b95220F2f9af86c68CE90b79085"
  "0x4Fdd5551d20f0D3798fD9Da624Ae8FCC6959EDB2"
  "0x1d7C41eCc9D30f84a922708C9aEA53C3F5DBcB65"
  "0x3e1fD6000B547F1D8302D6eeB89aadeEA5F6dE3d"
  "0x4Ae924b2b7F4992b11285DAFE052D158Dfd80d06"
  "0x7d4B0dEDB4E8D43801823632e788cd600e45292C"
  "0x2F38a48F8968114aA5a62E3A106d2D3DD5478bF2"
  "0x2F53c488E589c1e023ccE9f21f1379213A7C30fa"
  "0xE38C099F0732eca09881F99E7431A619d3D033d9"
)

IFS=,
GUARDIAN_SET="([${GUARDIAN_ADDRESSES[*]}], $EXPIRATION_TIME)"

# Verifier Update
UPDATE_FUNCTION_SIG="update(bytes)"
PULL_AND_APPEND_MESSAGE=0x0200000001010a4c01000000001300c784b72bdbc69e5504aa1242eb7bd0ed6fac4a1781564bf2d86920e2d4c29a1807e1c30276e5f413e4ba1306640a3c21f5339729e4d67f2cec043050848387c000018cd679bcc0b02021fd44831e7dc98fbf7e6345cb27315b8e7923e6deaaf232bb6e061d7bb1ca927a7e23dc1961d54187f5c4257d1d6bc39848b669d4f01425270002775c91c5982248a1db4832b4d2625cc3733cbdd9fa80a4ff52f2103d32c4650c73ba6941244acbe55cb62fbb04f98bbe6d59fc9be3b2802c557f82e182750ae00003f30ff41563588014f41408fedb77e937c1166a36f876b43cc3d67a6a8829f1f80ae6d2de6e497c6e50741a82c3723c0bca7c23c21e406905c1a2823914c28648000477728606d481c8357c47b93478a5d7d91bfcc256bda8603f3859c3770fdff8f34b68300a5553c6503231381ddffd5f327cda90b009c12772ab280b74ad041ee001052fd1b5c788173564cb606a3b71f448f1a6f9d7cf27e1f307523a93d63be9be3255dd97ad2acbf8f50adff60b0824a4a7951cc00da3daf62b1daac5f955215b550006dde6eb08bf523ce2e8c0cf3a473d6815435dadc9dfe779d35b6a82d0346890347b84dfab5ccf7d0cf518b786a84ba451f51906ac7cb82786b4f0c42bf6849d9a0107403a723f07cbcdcf5929e7d532268911c898771e4ff6f97d4ef6dc53a503658a42dd99a6e75509b7ec8d50cfe71999fdec7f701bcb087887f4e5bf187d0de07a0008f59922132f01bdd1fc3fe06aa259ec0c1cf7c0fe540df5ae4fb98b8c3271c0a668de31e5d4a3badfafa9db3d04144f825cc586d037bc2ae8ab5112c467d45e17010936f22ca8d661f2ef1a8d5b137f25f13096ee386c5f21cfebb15026ebaea247021534c2b5888bb84105d2468ed51f2509384a1e2a0c149bd01e190627febc682c000a70025707a7a678310ccb4854be55ece069ccd2c12f9b3c14a1ec86bed0aef7a16a77a2f69979f3e8fdcaeffe04aca36a10f401e31d94b83da21e0b1e57b8506a010b7cdd119fb609d6ab1f0c4b5fffc08edc6201d335d5d8bdb1957ba66112ca2b8e74676cc181c431bfc5b15daec79f90485cb6cd2f186576232ce327f25d99bf28010c9d9230d97ced30899540eac30dcd61bca8bad2e942ff755b77423c38777d90fa51dcf65e503bd2b74e2a51ff9230bd152d9cc127572f33057bffac00c4a0c0f5010dae858697d71e8699d9fd540a07e7058b37b7b92af3e0d28bec3581c54190a8ff5a9161b86a676054ee4cb58261f0a9d4d3ac445534560041c7eceb1284fb0850010e10bea0368026099259909b9f16f6303abdd63a0718c88a8009a03b5ab042154936c1f8c6fca7c73215ddabc9d47d0e1ac75861e2674784c11053a80aef6b1f1b010fd93a93d7c58851b5b2e2a18fdb126b4a0e3e2985ea1618245ef977cd44219fd06beb7def5842df4f7a1cdfb98fad3b3b41658c1e7198755388f1c6eed97496dd01109d9d17618012f0ae4127d41a7218bf2d36607b4d542abe750481e71b4a50443d275acd51043f5c2f7b97d072b9e725a2b773db1d7994d4780aa7e008c83d0b2e01113e7be58ec63f184f8e7ff87d77bb81f54fa23751aaa29cd4a038ef67784dd7f8719bc49ded5f77a9af49bc498d4fc185725bf5cf6b17f85be1659518e3a465a7011210bbde4e6b986e2a8bf190d8fe1ad38cf686b8a13684cc8555f5139dda344e274d660f7ed457b2db848d21e1f7e4cf8ee200eaa28bf65914fc5da2f76d44401a000000000100000000000100000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000545353010000000000000000c11b6c8b8e4ecc62ebf10437678eb70f17f1e53abdb3fa8df1912e3b3d11b5b9000000007af3ae7c8391b4ed809917baff6b5ba28a315410aa382d07f5fa84a9c51c31af0000000000000000000000000000000000000000000000000000000000000013c67c82a42364074e4a3ffec944a96d758cec08da09275ada471fe82c95159af922b517009ccd7ede90cebf16ab630868989172c72ebd70ffc6d04cb783eeba6182272a56366878aa05e5cbcd5cd1d195d14ca26064be20cdb7aacebcf2c86a206e24f50d0c1bae02d47e0ef5ae26cc5e3ee7d98660b508736fa4a7d64fe3c625c81a9b27aeef5a963959d5e424a0686a981918a009cacef18ded6e6496c9a808439bd6108f1590b56ebdea0706c2dc308240c4a47d94f42d16f92db81f6222b9a2218874818e7da07f632a9c9bbfcd96ed478b6a4a6a9829bff2eb5f8ed719a8d73ba7c666d41f554e8beaf96d5e2ae6590aefc7b5ef7008dc0b49b6328966a07b015af9ed3b47ff5a1a71410bbda0aaf40111858925784658f19acf4c085f2efe156e000de4ae76fd51fb41331bbab47a10a6f0d8ea96859cd5f66e2ec9b6a9ebbe5853f748ac603c984ed162ee44d2e898ca4552f3b153f59a665681ab2c00155f68801d5a51f216b26a3e0f5fb41a1f0525a61cddb6b0ab2b4c19213ebc552c45b839f24d1cb4ea25c0079e62f930f91499c77d13b43074b3c3810718cd8d61bad7e65e328ae170db4326021c7585baadae785350e12f1f2bdb7e73c10b289f8efce656540a4ddd16a323d7a3e2e9355dc13c7afa1f6197ea72cfc1375517ef60c2cd0f8ae627298a1dd237670198aa1dabb3cbcf2a532fd1cadc698788e383b81eb33a7fcb0694e212de9e4fb0db2579e8c4941a43adae1ebd8f43559aa924b2e1ac892f26e3741cd99b29ceb4c9f6acadb1af74942e83f23f8d37dcb6d6759540959b56070ee6effb4793af059d49897d9b54edaf78f0f06f5b03ec6c2c00000000000000000000000000000000000000000000000000000000000000130000000000000000000000001bb315e24af6bb5daba538dd17a6168cfa91a213000000000000000000000000d1ffc4dd68bd8f241032b5beac1cf6099c5c80110000000000000000000000007ab4f18499e49ff14b1b1eaad92c0229036ad0520000000000000000000000004ac1bdfcdc3ef49a9553d1bcf6a56e36e815ea06000000000000000000000000d1523f8e5dc2ecf403dc733819cb20185f8d6ad1000000000000000000000000b7d8612e65d6f95707173492bb497728108b6b9a0000000000000000000000003022ee66b0fd56d6a3f0b5b520973b29c2ef67ea0000000000000000000000008b0798246b538f49eaf429b5b011eb65c5a30cde0000000000000000000000009b550e6cb0553dee579ecf2700d096bb235783f10000000000000000000000007ba7f6acfcd9a721eb906a2da8ebcbc8a83f250b0000000000000000000000006ebda46121d17b95220f2f9af86c68ce90b790850000000000000000000000004fdd5551d20f0d3798fd9da624ae8fcc6959edb20000000000000000000000001d7c41ecc9d30f84a922708c9aea53c3f5dbcb650000000000000000000000003e1fd6000b547f1d8302d6eeb89aadeea5f6de3d0000000000000000000000004ae924b2b7f4992b11285dafe052d158dfd80d060000000000000000000000007d4b0dedb4e8d43801823632e788cd600e45292c0000000000000000000000002f38a48f8968114aa5a62e3a106d2d3dd5478bf2010a4c0100000000130038bdd723fbe87acb6cebac6f6b250dd67d8c79609fe9680406c5ec06ffb030ba2382bfe3f84f71b695b8a7f9cac579ba08bce9531dc888f756903d3606844e530001e832daa17b481bae90f65d912de12855efd69330795210e5ca0627c2062d2b3957bde66a6ef2c50e50a431ba700c74deb635d4d193cb666ffef4771e9c56788100024e04df9e21405713919a91e25935abbf5f772ea97256f35bc70be5ce30161bd57230368755b6e757f6574abb71037aca755e4582898f434d36d15a64510cf3120003c0d6f16b3bad00ef78b3c5e9b6b13975c67bab8abae9477e236f159069036dcc0871657314684d4618a1d1c01ec4484d6cf8d1f2ef77d15aa65360f5b06ae5280004680f1b88e7284e04b1a95ccb62ed0661242f8abc9323105639b60e22ded1c70d4129c165dd58c943fd513e878fcd4dc3fb201ef181d8251ba39eced82c92ee6b000553f5989e4f5bcee22aa27e3d76cec1d441cb75184a5ea06b369f2cf026f9fe3a5bb540d08bbf2f06a950b928a907d11a6f5cdeed255be6fc01db61e19d27a9440006ac03376fc0913caba1d2bc1d8e51378883f491a34e51e0b0f582ea207ab8eae24d43d7ddabd7b51846bbbc3fb4f0b93433b860e4bea53990a44a8860eb4c611301076bce961fe9c60bc1e7f9540ad792718ca14e1dc8d4b6a3fee2e5d2ee1d07df4719c5ddc716db7b7b11f3fd60122b1e625740f124acee64771e5a3e94e99b86ce00084e0b0c75f1f7190fc5b2f02e553c9f3922af7ad267f74468139536f374e3e07057fbf23e3b8eacee916ec46d12b0283878f7e95f9644d268aa60699d4a20aace00095341fe0a7fad83e34c43d903917ed422df0493c82c42a3b8453a1ebb3cfc6517222527ec944167b2f7f42944698c49a89d4fe1b8d900f3f1064aaa61714b24ed010a977d3781675af3ad76c8c65d7b2b22a72b4c94bbd71bb7f01a61745d3b08b731393a49d1c0bb35c866a1320af9ce62cbe38a502a0e1492c08fe25015fe5af6c0010b2dc5fdb0ccf2371b63403c2b66243dc6c7911341255141544345660fa777604d2994c1320be28f3e7a9f5c8361818603a0d5c0ec3f1440b05f982a1f45573eb1010c1ea0f0771a82568b333ab7fc39e78861cd1feb5e883a5e9ec622699db0475d8308a096e2b38372da6ac9acc6a4e5bf7e7c0d9c27f325792f1b4bad60b0559ff3000d74083918894415bd7973ae66ba458b88fad1c87239e94df2c38b255dbc51db4075cb60fa2638f36791e86ad758c3c7434342d507a43d56507b1bd3a4c9105bfe010e6961de7e9262854369632aaeafcbaf489a6f257c94fc4820f07f17c28c699b0640e2cea75d8ec8d193f252aa8d1404d02f9927a6ace53e4894c5ced89c56957d000f75ffbaf7255d8e9f3dd236261f4d1a892f349f2443934af11bf70cd8bd3e821e1b1c0e9fc8447705e15625325062192ae084cbd44e1f4bd53a0d14da690f5649011053a91e0d339c6075de697c6889b06eebecc392c92dc3c9e34cb72eddc4640a3442406d81f8cb484c63278c94576fde969a22e1fd32eb51e84409aadb31ff1f1300113ade6f3bcbdfc248a2b26872869ac39b7b7731bf25887f82085790b73a6b59367d1298668186e2cbc8007da8f1b6aaded73db30c03d06c275e30ee6058a0e362001215f45e167c8563d6920091ba99088ff5bb9c0f874aa4defd3814d9307c983b19204e3c33f7f062493d9c413a6fb1afa9e6b2ebeea49b77fca9806c8bf28452a801000000010000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000054535301000000010000000055c79afbfe1347cd62a6af7cfb28c20d4cc83f64e258a3140928518b96b004fc000151807af3ae7c8391b4ed809917baff6b5ba28a315410aa382d07f5fa84a9c51c31af0000000000000000000000000000000000000000000000000000000000000013c67c82a42364074e4a3ffec944a96d758cec08da09275ada471fe82c95159af922b517009ccd7ede90cebf16ab630868989172c72ebd70ffc6d04cb783eeba6182272a56366878aa05e5cbcd5cd1d195d14ca26064be20cdb7aacebcf2c86a206e24f50d0c1bae02d47e0ef5ae26cc5e3ee7d98660b508736fa4a7d64fe3c625c81a9b27aeef5a963959d5e424a0686a981918a009cacef18ded6e6496c9a808439bd6108f1590b56ebdea0706c2dc308240c4a47d94f42d16f92db81f6222b9a2218874818e7da07f632a9c9bbfcd96ed478b6a4a6a9829bff2eb5f8ed719a8d73ba7c666d41f554e8beaf96d5e2ae6590aefc7b5ef7008dc0b49b6328966a07b015af9ed3b47ff5a1a71410bbda0aaf40111858925784658f19acf4c085f2efe156e000de4ae76fd51fb41331bbab47a10a6f0d8ea96859cd5f66e2ec9b6a9ebbe5853f748ac603c984ed162ee44d2e898ca4552f3b153f59a665681ab2c00155f68801d5a51f216b26a3e0f5fb41a1f0525a61cddb6b0ab2b4c19213ebc552c45b839f24d1cb4ea25c0079e62f930f91499c77d13b43074b3c3810718cd8d61bad7e65e328ae170db4326021c7585baadae785350e12f1f2bdb7e73c10b289f8efce656540a4ddd16a323d7a3e2e9355dc13c7afa1f6197ea72cfc1375517ef60c2cd0f8ae627298a1dd237670198aa1dabb3cbcf2a532fd1cadc698788e383b81eb33a7fcb0694e212de9e4fb0db2579e8c4941a43adae1ebd8f43559aa924b2e1ac892f26e3741cd99b29ceb4c9f6acadb1af74942e83f23f8d37dcb6d6759540959b56070ee6effb4793af059d49897d9b54edaf78f0f06f5b03ec6c2c00000000000000000000000000000000000000000000000000000000000000130000000000000000000000001bb315e24af6bb5daba538dd17a6168cfa91a213000000000000000000000000d1ffc4dd68bd8f241032b5beac1cf6099c5c80110000000000000000000000007ab4f18499e49ff14b1b1eaad92c0229036ad0520000000000000000000000004ac1bdfcdc3ef49a9553d1bcf6a56e36e815ea06000000000000000000000000d1523f8e5dc2ecf403dc733819cb20185f8d6ad1000000000000000000000000b7d8612e65d6f95707173492bb497728108b6b9a0000000000000000000000003022ee66b0fd56d6a3f0b5b520973b29c2ef67ea0000000000000000000000008b0798246b538f49eaf429b5b011eb65c5a30cde0000000000000000000000009b550e6cb0553dee579ecf2700d096bb235783f10000000000000000000000007ba7f6acfcd9a721eb906a2da8ebcbc8a83f250b0000000000000000000000006ebda46121d17b95220f2f9af86c68ce90b790850000000000000000000000004fdd5551d20f0d3798fd9da624ae8fcc6959edb20000000000000000000000001d7c41ecc9d30f84a922708c9aea53c3f5dbcb650000000000000000000000003e1fd6000b547f1d8302d6eeb89aadeea5f6de3d0000000000000000000000004ae924b2b7f4992b11285dafe052d158dfd80d060000000000000000000000007d4b0dedb4e8d43801823632e788cd600e45292c0000000000000000000000002f38a48f8968114aa5a62e3a106d2d3dd5478bf2

anvil --quiet --host 0.0.0.0 &
forge create --private-key $PRIVATE_KEY --broadcast test/WormholeVerifier.t.sol:WormholeV1Mock
forge create WormholeVerifier --private-key $PRIVATE_KEY --broadcast --constructor-args $MOCK_ADDRESS 0 0 0 0x
cast send --private-key $PRIVATE_KEY $MOCK_ADDRESS "$APPEND_SET_FUNCTION_SIG" "$GUARDIAN_SET"
cast send --private-key $PRIVATE_KEY $VERIFIER_ADDRESS "$UPDATE_FUNCTION_SIG" "$PULL_AND_APPEND_MESSAGE"
fg
