#!/bin/bash

set -meuo pipefail

# Anvil Private Key
PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

# Contract Addresses
MOCK_ADDRESS=0x5FbDB2315678afecb367f032d93F642f64180aa3
VERIFIER_ADDRESS=0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
GUARDIAN_ADDRESS=0xEC268183Ac3ad3611Dd18713e6103E54ABfF9d82

# Guardian Set
APPEND_SET_FUNCTION_SIG="appendGuardianSet((address[], uint32))"
EXPIRATION_TIME=$(date -d "1 year" +%s)
GUARDIAN_SET="([$GUARDIAN_ADDRESS], $EXPIRATION_TIME)"

# Verifier Update
UPDATE_FUNCTION_SIG="update(bytes)"
PULL_GUARDIAN_SET_MESSAGE=0x0200000001
APPEND_SCHNORR_KEY_MESSAGE=0x0101280100000000010062e3a31708e16be10158658dc43f827aa8d23929acd7888ab5cee0d45cf7ea134b36315f8b16e4853b4786f038a9c0f47361e9e4e25d376d6f905fce992c7803000000000100000000000100000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000545353010000000000000000c11b6c8b8e4ecc62ebf10437678eb70f17f1e53abdb3fa8df1912e3b3d11b5b900000000819b63672151031143b6ae4128eb3e201326e12e3d85f5a620b4fd21f0bb6ec200000000000000000000000000000000000000000000000000000000000000011d7179b2c3c721f090dbbabac858efc3cd9c212d9746e9c20a8b178140f18061

anvil&
forge create --private-key $PRIVATE_KEY --broadcast test/TestAssembly2.sol:WormholeV1Mock
forge create WormholeVerifier --private-key $PRIVATE_KEY --broadcast --constructor-args $MOCK_ADDRESS 0 0 0 0x
cast send --private-key $PRIVATE_KEY $MOCK_ADDRESS "$APPEND_SET_FUNCTION_SIG" "$GUARDIAN_SET" 
cast send --private-key $PRIVATE_KEY $VERIFIER_ADDRESS "$UPDATE_FUNCTION_SIG" "$PULL_GUARDIAN_SET_MESSAGE" 
cast send --private-key $PRIVATE_KEY $VERIFIER_ADDRESS "$UPDATE_FUNCTION_SIG" "$APPEND_SCHNORR_KEY_MESSAGE" 
fg
